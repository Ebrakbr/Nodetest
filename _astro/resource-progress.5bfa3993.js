import{a as p,b as g}from"./http.e11c6b00.js";import{a as d,T as f}from"./jwt.1d42f94f.js";async function E(r){const{topicId:o,resourceType:s,resourceId:e}=r,t=await c(s,e);return t?t.includes(o):!1}async function $(r,o){const{topicId:s,resourceType:e,resourceId:t}=r,{response:n,error:a}=await g("https://api.roadmap.sh/v1-toggle-mark-resource-done",{topicId:s,resourceType:e,resourceId:t,isDone:o});if(a||!n?.done)throw new Error(a?.message||"Something went wrong");return i(e,t,n.done),o}async function c(r,o){if(!d.get(f))return[];const s=`${r}-${o}-progress`,e=localStorage.getItem(s),t=JSON.parse(e||"null"),n=t?.timestamp,u=new Date().getTime()-parseInt(n||"0",10)>15*60*1e3;return!t||u?l(r,o):t.done}async function l(r,o){const{response:s,error:e}=await p("https://api.roadmap.sh/v1-get-user-resource-progress",{resourceType:r,resourceId:o});return e?(console.error(e),[]):s?.done?(i(r,o,s.done),s.done):[]}function i(r,o,s){localStorage.setItem(`${r}-${o}-progress`,JSON.stringify({done:s,timestamp:new Date().getTime()}))}function m(r,o){const s=[];document.querySelectorAll(`[data-group-id$="-${r}"]`).forEach(e=>{const t=e?.dataset?.groupId||"";new RegExp(`^\\d+-${r}$`).test(t)&&s.push(e)}),document.querySelectorAll(`[data-group-id="${r}"]`).forEach(e=>{s.push(e)}),document.querySelectorAll(`[data-group-id="check:${r}"]`).forEach(e=>{s.push(e)}),s.forEach(e=>{o?e.classList.add("done"):e.classList.remove("done")})}async function y(r,o){(await c(r,o)).forEach(e=>{m(e,!0)})}export{y as a,E as i,m as r,$ as t};
